# Source Info:
#  {
#    "Provider": "MA_BOSTON",
#    "State": "MA",
#    "Name": "City of Boston, MA",
#    "Title": "Certified Business Directory - Datasets - Analyze Boston",
#    "ImportedFileName": "tmpj8geo5py.csv"
#  }
#
# ╔═══════════════════════════╦══════════════════════╦════════════╗
# ║ DEST_COL_NAME             ║ SRC_COL_NAME         ║ SRC_COL_NO ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Sequence                  ║ Program              ║  Generated ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Company Name              ║ company_name         ║      1     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ DBA                       ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ DUNS Number               ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Addr Line 1               ║ address              ║      8     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Addr Line 2               ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ City                      ║ city                 ║      9     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ State                     ║ state                ║     10     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Zip Code                  ║ zipcode              ║     11     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Website                   ║ website              ║     18     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Contact Person            ║ contact_name         ║     12     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Phone                     ║ phone                ║     14     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Cell Phone                ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Fax                       ║ fax                  ║     15     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Email Address             ║ email                ║     16     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Gender                    ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Ethnicity                 ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Given Diversity           ║ mbe_wbe_cert,        ║    3,4,5   ║
# ║                           ║ small_local_cert,    ║            ║
# ║                           ║ veteran_cert         ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Primary Diversity         ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Other Diversities         ║                      ║     6,7    ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Certifying Agency         ║ 'City of Boston, MA' ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Certification Number      ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Certification Start Date  ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Certification Expiry Date ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Primary NAICS Code        ║ naics_codes_1        ║     25     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Other NAICS Codes         ║ naics_codes_2,       ║    26,27   ║
# ║                           ║ naics_codes_3        ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Business Description      ║ services_provided    ║      2     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Additional Details 1      ║ contact_title        ║     13     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Additional Details 2      ║ business_type        ║     18     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Additional Details 3      ║ construction         ║     19     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Additional Details 4      ║ date_business_estd   ║     20     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Additional Details 5      ║ number_of_employees  ║     21     ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Additional Details 6      ║ cob_category_codes   ║    22-24   ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Additional Details 7      ║ unspsc_codes         ║    28-30   ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Additional Details 8      ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Additional Details 9      ║                      ║            ║
# ╠═══════════════════════════╬══════════════════════╬════════════╣
# ║ Additional Details 10     ║                      ║            ║
# ╚═══════════════════════════╩══════════════════════╩════════════╝
#

import csv
import logging

from src import custom_logger, prepare_csv_data, empty_dict

log = custom_logger.LogGen.logGen()
log.setLevel(level=logging.DEBUG)

provider = "MA_BOSTON"
records = []


def processFile(filename):
    log.info(f'Loaded module {provider}...')

    with open(filename, encoding="utf8") as f:
        reader = csv.reader(f)
        next(reader, None)     # CSV Header

        for row_num, row in enumerate(reader):
            dict1 = empty_dict()
            dict1['source'] = provider
            dict1['sequence'] = prepare_csv_data(row_num + 1)
            dict1['company'] = prepare_csv_data(row[0])
            dict1['addr1'] = prepare_csv_data(row[7])
            dict1['city'] = prepare_csv_data(row[8])
            dict1['state'] = prepare_csv_data(row[9])
            dict1['zipcode'] = prepare_csv_data(row[10])
            dict1['website'] = prepare_csv_data(row[16])
            dict1['contact'] = prepare_csv_data(row[11])
            dict1['phone'] = prepare_csv_data(row[13])
            dict1['fax'] = prepare_csv_data(row[14])
            dict1['email'] = prepare_csv_data(row[15])
            dict1['gdiverse'] = prepare_csv_data(','.join([row[2], row[3], row[4]]))
            dict1['cert_agency'] = 'City of Boston, MA'
            dict1['pnaics'] = prepare_csv_data(row[24], pattern='^[^ ]*')
            dict1['onaics'] = ','.join([prepare_csv_data(row[25], pattern='^[0-9]{6}'),
                                        prepare_csv_data(row[26], pattern='^[0-9]{6}')])
            dict1['biz_desc'] = prepare_csv_data(row[1])
            dict1['addl1'] = prepare_csv_data(row[12], prefix='Contact Title')
            dict1['addl2'] = prepare_csv_data(row[17], prefix='Business Type')
            dict1['addl3'] = prepare_csv_data(row[18], prefix='Construction?')
            dict1['addl4'] = prepare_csv_data(row[19], prefix='Date Business Estd.')
            dict1['addl5'] = prepare_csv_data(row[20], prefix='No.of Employees')
            dict1['addl6'] = prepare_csv_data(','.join([prepare_csv_data(row[21]),
                                                        prepare_csv_data(row[22]),
                                                        prepare_csv_data(row[23])]),
                                              prefix='Cob Category Codes')
            dict1['addl7'] = prepare_csv_data(','.join([prepare_csv_data(row[21], pattern='^[0-9]{8}'),
                                                        prepare_csv_data(row[22], pattern='^[0-9]{8}'),
                                                        prepare_csv_data(row[23], pattern='^[0-9]{8}')]),
                                              prefix='UNSPSC Codes')
            records.append(dict1)

    return records
