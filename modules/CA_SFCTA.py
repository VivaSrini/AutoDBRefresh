# Source Info:
#  {
#    "Provider": "CA_SFCTA_LGBTE",
#    "State": "CA",
#    "Name": "San Francisco County Transportation Authority",
#    "Title": "Work with Us | SFCTA",
#    "ImportedFileName": "SFCTA_Certified_DBE_LBE_12-30-21.xlsx"
#  }
#
# ╔═══════════════════════════╦═══════════════════════════╦════════════╗
# ║ DEST_COL_NAME             ║ SRC_COL_NAME              ║ SRC_COL_NO ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Sequence                  ║ Program                   ║  Generated ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Company Name              ║ Business Name             ║      1     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ DBA                       ║ Doing Business As         ║      2     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ DUNS Number               ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Addr Line 1               ║ Street Address            ║      4     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Addr Line 2               ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ City                      ║ City                      ║      5     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ State                     ║ StateCode                 ║      6     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Zip Code                  ║ 5-digit Zip Code          ║      7     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Website                   ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Contact Person            ║ ContactFirstName          ║      9     ║
# ║                           ║ ContactLastName           ║     10     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Phone                     ║ Main Phone                ║      8     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Cell Phone                ║ Contact Phone             ║     12     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Fax                       ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Email Address             ║ Email Address             ║     13     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Gender                    ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Ethnicity                 ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Given Diversity           ║ DBE                       ║     14     ║
# ║                           ║ LBE                       ║     15     ║
# ║                           ║ DVBE                      ║     16     ║
# ║                           ║ LGBTBE                    ║     17     ║
# ║                           ║ SBE                       ║     18     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Primary Diversity         ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Other Diversities         ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Certifying Agency         ║ "SFCTA"                   ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Certification Number      ║ DBE Certification#        ║     58     ║
# ║                           ║ LBE Certification#        ║     59     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Certification Start Date  ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Certification Expiry Date ║ Certification Expiry Date ║     60     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Primary NAICS Code        ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Other NAICS Codes         ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Business Description      ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Additional Details 1      ║ Year Established          ║      3     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Additional Details 2      ║ Job Title                 ║     11     ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Additional Details 3      ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Additional Details 4      ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Additional Details 5      ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Additional Details 6      ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Additional Details 7      ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Additional Details 8      ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Additional Details 9      ║                           ║            ║
# ╠═══════════════════════════╬═══════════════════════════╬════════════╣
# ║ Additional Details 10     ║                           ║            ║
# ╚═══════════════════════════╩═══════════════════════════╩════════════╝

import logging

import openpyxl

from src import custom_logger, empty_dict, prepare_csv_data, get_primary

log = custom_logger.LogGen.logGen()
log.setLevel(level=logging.DEBUG)

provider = "CA_SFCTA"
records = []


def processFile(filename):
    log.info(f'Loaded module {provider}...')
    wb = openpyxl.load_workbook(filename)
    ws = wb.active
    row_num = 2

    while ws.cell(row_num, 1).value:
        dict1 = empty_dict()
        diversity = []
        cert_num = []
        dict1['source'] = provider
        dict1['sequence'] = prepare_csv_data(row_num - 1)
        dict1['company'] = prepare_csv_data(ws.cell(row_num, 1).value)
        dict1['dba'] = prepare_csv_data(ws.cell(row_num, 2).value)
        dict1['addr1'] = prepare_csv_data(ws.cell(row_num, 4).value)
        dict1['city'] = prepare_csv_data(ws.cell(row_num, 5).value)
        dict1['state'] = prepare_csv_data(ws.cell(row_num, 6).value)
        dict1['zipcode'] = prepare_csv_data(ws.cell(row_num, 7).value)
        dict1['contact'] = prepare_csv_data(ws.cell(row_num, 9).value)
        dict1['contact'] += ' ' + prepare_csv_data(ws.cell(row_num, 10).value)
        dict1['phone'] = prepare_csv_data(ws.cell(row_num, 8).value)
        dict1['cellphone'] = prepare_csv_data(ws.cell(row_num, 12).value)
        dict1['cert_num'] = prepare_csv_data(ws.cell(row_num, 1).value)
        dict1['email'] = prepare_csv_data(ws.cell(row_num, 13).value)
        if ws.cell(row_num, 14).value: diversity.append('DBE')
        if ws.cell(row_num, 15).value: diversity.append('LBE')
        if ws.cell(row_num, 16).value: diversity.append('DVBE')
        if ws.cell(row_num, 17).value: diversity.append('LGBTBE')
        if ws.cell(row_num, 18).value: diversity.append('SBE')
        dict1['gdiverse'] = ','.join(diversity)
        dict1['cert_agency'] = 'SFCTA'
        if ws.cell(row_num, 58).value: cert_num.append(ws.cell(row_num, 58).value)
        if ws.cell(row_num, 59).value: cert_num.append(ws.cell(row_num, 59).value)
        dict1['cert_num'] = ','.join(cert_num)
        dict1['cert_expiry'] = prepare_csv_data(get_primary(ws.cell(row_num, 60).value))
        records.append(dict1)
        row_num += 1

    return records
